# Stability study

## Issue

Sampo found that the same training scripts, with the same setups, converge on puhti (V100 / cuda) but diverge on LUMI (MI250X / ROCm)

![lumivspuhti](assets/lumivspuhti.png)

## Experiments

Notes on the different experiments that were run trying to understand what causes the instabilities in our trainings:

Summary of the experiments:

| Experiment | Description | Logs | Tensorboard |
| --- | --- | --- | --- |
| [blowup-1](stability_study/blowup-1.sh) | Adapt [tr7b-350M-modeling-alibi.slurm](https://github.com/bigscience-workshop/bigscience/blob/master/train/tr7-alibi/tr7b-350M-modeling-alibi.slurm) to LUMI | [logs](stability_study/logs/blowup-1-1793404.out) | [tb](https://huggingface.co/nouamanetazi/lumi_logs/tensorboard?scroll=1#scalars&runSelectionState=eyJ0ZW5zb3Jib2FyZC9ibG93dXAtMS8xNzkzNDA0Ijp0cnVlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtMi8xNzkzNDM4IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTItYWRhbS8xNzkzNDg4IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS8xNzkzNDkwIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1ncHUxLzE3OTM1MDMiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtMy1hZGFtLWZwMzIvMTc5MzUwMSI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0temVyby8xNzkzNTE0IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS8xNzkzNzM2IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS8xNzkzNzM3IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1ub2tlcm5lbC8xNzkzNzYxIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1ub2tlcm5lbC8xNzkzNzYzIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS8xNzk0MjM1IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1ub2tlcm5lbC8xNzk1MzY3IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1ub2tlcm5lbC8xNzk2MjEyIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1iZjE2LzE3OTYyMjkiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLW5va2VybmVsLzE3OTYyOTciOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLWFsaWJpLWZwMzIvMTc5NjMwMCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC01LWFkYW0vMTc5NjMwMSI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmktYmYxNi8xNzk2MzAzIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTUtYWRhbS8xNzk2Mzc0IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1iZjE2LXJhbXAzMi8xNzk2Mzc1IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1yYW1wMzIvMTc5NjM3NiI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0tbm9rZXJuZWwtMi8xNzk2NDY3IjpmYWxzZX0%3D)
| [blowup-2](stability_study/blowup-2.sh) | use `ZERO_STAGE=0` | [logs](stability_study/logs/blowup-2-1793438.out) | [tb](https://huggingface.co/nouamanetazi/lumi_logs/tensorboard?scroll=1#scalars&runSelectionState=eyJ0ZW5zb3Jib2FyZC9ibG93dXAtMS8xNzkzNDA0IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTIvMTc5MzQzOCI6dHJ1ZSwidGVuc29yYm9hcmQvYmxvd3VwLTItYWRhbS8xNzkzNDg4IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS8xNzkzNDkwIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1ncHUxLzE3OTM1MDMiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtMy1hZGFtLWZwMzIvMTc5MzUwMSI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0temVyby8xNzkzNTE0IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS8xNzkzNzM2IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1ub2tlcm5lbC8xNzkzNzYzIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS8xNzk0MjM1IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1iZjE2LzE3OTYyMjkiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLW5va2VybmVsLzE3OTYyOTciOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLWFsaWJpLWZwMzIvMTc5NjMwMCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmktYmYxNi1ub2tlcm5lbC8xNzk5NzY3IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1mcDMyLW5va2VybmVsLzE3OTk3NzEiOmZhbHNlfQ%3D%3D) |
| [blowup-2-adam](stability_study/blowup-2-adam.sh) | use pytorch `Adam` instead of apex's `FusedAdam` | [logs](stability_study/logs/blowup-2-adam-1793488.out) | [tb](https://huggingface.co/nouamanetazi/lumi_logs/tensorboard?scroll=1#scalars&runSelectionState=eyJ0ZW5zb3Jib2FyZC9ibG93dXAtMS8xNzkzNDA0IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTIvMTc5MzQzOCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0yLWFkYW0vMTc5MzQ4OCI6dHJ1ZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS8xNzkzNDkwIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1ncHUxLzE3OTM1MDMiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtMy1hZGFtLWZwMzIvMTc5MzUwMSI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0temVyby8xNzkzNTE0IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS8xNzkzNzM2IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1ub2tlcm5lbC8xNzkzNzYzIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS8xNzk0MjM1IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1iZjE2LzE3OTYyMjkiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLW5va2VybmVsLzE3OTYyOTciOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLWFsaWJpLWZwMzIvMTc5NjMwMCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmktYmYxNi1ub2tlcm5lbC8xNzk5NzY3IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1mcDMyLW5va2VybmVsLzE3OTk3NzEiOmZhbHNlfQ%3D%3D) |
| blowup-3-adam | use dynamic loss scale + `Adam` | [logs]() | [tb](https://huggingface.co/nouamanetazi/lumi_logs/tensorboard?scroll=1#scalars&runSelectionState=eyJ0ZW5zb3Jib2FyZC9ibG93dXAtMS8xNzkzNDA0IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTIvMTc5MzQzOCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0yLWFkYW0vMTc5MzQ4OCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0vMTc5MzQ5MCI6dHJ1ZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1ncHUxLzE3OTM1MDMiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtMy1hZGFtLWZwMzIvMTc5MzUwMSI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0temVyby8xNzkzNTE0IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS8xNzkzNzM2IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1ub2tlcm5lbC8xNzkzNzYzIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS8xNzk0MjM1IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1iZjE2LzE3OTYyMjkiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLW5va2VybmVsLzE3OTYyOTciOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLWFsaWJpLWZwMzIvMTc5NjMwMCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmktYmYxNi1ub2tlcm5lbC8xNzk5NzY3IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1mcDMyLW5va2VybmVsLzE3OTk3NzEiOmZhbHNlfQ%3D%3D) |
| blowup-3-adam-zero | use `Adam` + zero stage 1 | [logs]() | [tb](https://huggingface.co/nouamanetazi/lumi_logs/tensorboard?scroll=1#scalars&runSelectionState=eyJ0ZW5zb3Jib2FyZC9ibG93dXAtMS8xNzkzNDA0IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTIvMTc5MzQzOCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0yLWFkYW0vMTc5MzQ4OCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0vMTc5MzQ5MCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0tZ3B1MS8xNzkzNTAzIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1mcDMyLzE3OTM1MDEiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtMy1hZGFtLXplcm8vMTc5MzUxNCI6dHJ1ZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS8xNzkzNzM2IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1ub2tlcm5lbC8xNzkzNzYzIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS8xNzk0MjM1IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1iZjE2LzE3OTYyMjkiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLW5va2VybmVsLzE3OTYyOTciOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLWFsaWJpLWZwMzIvMTc5NjMwMCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmktYmYxNi1ub2tlcm5lbC8xNzk5NzY3IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1mcDMyLW5va2VybmVsLzE3OTk3NzEiOmZhbHNlfQ%3D%3D) |
| blowup-3-adam-gpu1 | `Adam` + use a single GPU | [logs]() | [tb](https://huggingface.co/nouamanetazi/lumi_logs/tensorboard?scroll=1#scalars&runSelectionState=eyJ0ZW5zb3Jib2FyZC9ibG93dXAtMS8xNzkzNDA0IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTIvMTc5MzQzOCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0yLWFkYW0vMTc5MzQ4OCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0vMTc5MzQ5MCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0tZ3B1MS8xNzkzNTAzIjp0cnVlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtMy1hZGFtLWZwMzIvMTc5MzUwMSI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0temVyby8xNzkzNTE0IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS8xNzkzNzM2IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1ub2tlcm5lbC8xNzkzNzYzIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS8xNzk0MjM1IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1iZjE2LzE3OTYyMjkiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLW5va2VybmVsLzE3OTYyOTciOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLWFsaWJpLWZwMzIvMTc5NjMwMCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmktYmYxNi1ub2tlcm5lbC8xNzk5NzY3IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1mcDMyLW5va2VybmVsLzE3OTk3NzEiOmZhbHNlfQ%3D%3D) |
| blowup-3-adam-fp32 | `Adam` + fp32 precision | [logs]() | [tb](https://huggingface.co/nouamanetazi/lumi_logs/tensorboard?scroll=1#scalars&runSelectionState=eyJ0ZW5zb3Jib2FyZC9ibG93dXAtMS8xNzkzNDA0IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTIvMTc5MzQzOCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0yLWFkYW0vMTc5MzQ4OCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0vMTc5MzQ5MCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0tZ3B1MS8xNzkzNTAzIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1mcDMyLzE3OTM1MDEiOnRydWUsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0temVyby8xNzkzNTE0IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS8xNzkzNzM2IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1ub2tlcm5lbC8xNzkzNzYzIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS8xNzk0MjM1IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1iZjE2LzE3OTYyMjkiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLW5va2VybmVsLzE3OTYyOTciOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLWFsaWJpLWZwMzIvMTc5NjMwMCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmktYmYxNi1ub2tlcm5lbC8xNzk5NzY3IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1mcDMyLW5va2VybmVsLzE3OTk3NzEiOmZhbHNlfQ%3D%3D) |
| blowup-3-adam-nokernel | `Adam` + no custom cuda kernels | [logs]() | [tb](https://huggingface.co/nouamanetazi/lumi_logs/tensorboard?scroll=1#scalars&runSelectionState=eyJ0ZW5zb3Jib2FyZC9ibG93dXAtMS8xNzkzNDA0IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTIvMTc5MzQzOCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0yLWFkYW0vMTc5MzQ4OCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0vMTc5MzQ5MCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0tZ3B1MS8xNzkzNTAzIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1mcDMyLzE3OTM1MDEiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtMy1hZGFtLXplcm8vMTc5MzUxNCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0vMTc5MzczNiI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0tbm9rZXJuZWwvMTc5Mzc2MyI6dHJ1ZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS8xNzk0MjM1IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1iZjE2LzE3OTYyMjkiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLW5va2VybmVsLzE3OTYyOTciOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLWFsaWJpLWZwMzIvMTc5NjMwMCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmktYmYxNi1ub2tlcm5lbC8xNzk5NzY3IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1mcDMyLW5va2VybmVsLzE3OTk3NzEiOmZhbHNlfQ%3D%3D) |
| blowup-4-adam | set optimizer + init args like [tr11e-350M-ml.slurm](https://github.com/bigscience-workshop/bigscience/blob/master/train/tr11-176B-ml/smaller_models/tr11e-350M-ml.slurm)  | [logs]() | [tb](https://huggingface.co/nouamanetazi/lumi_logs/tensorboard?scroll=1#scalars&runSelectionState=eyJ0ZW5zb3Jib2FyZC9ibG93dXAtMS8xNzkzNDA0IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTIvMTc5MzQzOCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0yLWFkYW0vMTc5MzQ4OCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0vMTc5MzQ5MCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0tZ3B1MS8xNzkzNTAzIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1mcDMyLzE3OTM1MDEiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtMy1hZGFtLXplcm8vMTc5MzUxNCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0vMTc5MzczNiI6dHJ1ZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1ub2tlcm5lbC8xNzkzNzYzIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS8xNzk0MjM1IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1iZjE2LzE3OTYyMjkiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLW5va2VybmVsLzE3OTYyOTciOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLWFsaWJpLWZwMzIvMTc5NjMwMCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmktYmYxNi1ub2tlcm5lbC8xNzk5NzY3IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1mcDMyLW5va2VybmVsLzE3OTk3NzEiOmZhbHNlfQ%3D%3D) |
| blowup-4-adam-alibi | alibi + embed layernorm | [logs]() | [tb](https://huggingface.co/nouamanetazi/lumi_logs/tensorboard?scroll=1#scalars&runSelectionState=eyJ0ZW5zb3Jib2FyZC9ibG93dXAtMS8xNzkzNDA0IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTIvMTc5MzQzOCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0yLWFkYW0vMTc5MzQ4OCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0vMTc5MzQ5MCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0tZ3B1MS8xNzkzNTAzIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1mcDMyLzE3OTM1MDEiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtMy1hZGFtLXplcm8vMTc5MzUxNCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0vMTc5MzczNiI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0tbm9rZXJuZWwvMTc5Mzc2MyI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmkvMTc5NDIzNSI6dHJ1ZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1iZjE2LzE3OTYyMjkiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLW5va2VybmVsLzE3OTYyOTciOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLWFsaWJpLWZwMzIvMTc5NjMwMCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmktYmYxNi1ub2tlcm5lbC8xNzk5NzY3IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1mcDMyLW5va2VybmVsLzE3OTk3NzEiOmZhbHNlfQ%3D%3D) |
| blowup-4-adam-nokernel | + no custom kernels | [logs]() | [tb](https://huggingface.co/nouamanetazi/lumi_logs/tensorboard?scroll=1#scalars&runSelectionState=eyJ0ZW5zb3Jib2FyZC9ibG93dXAtMS8xNzkzNDA0IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTIvMTc5MzQzOCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0yLWFkYW0vMTc5MzQ4OCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0vMTc5MzQ5MCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0tZ3B1MS8xNzkzNTAzIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1mcDMyLzE3OTM1MDEiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtMy1hZGFtLXplcm8vMTc5MzUxNCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0vMTc5MzczNiI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0tbm9rZXJuZWwvMTc5Mzc2MyI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmkvMTc5NDIzNSI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmktYmYxNi8xNzk2MjI5IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1ub2tlcm5lbC8xNzk2Mjk3Ijp0cnVlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLWFsaWJpLWZwMzIvMTc5NjMwMCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmktYmYxNi1ub2tlcm5lbC8xNzk5NzY3IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1mcDMyLW5va2VybmVsLzE3OTk3NzEiOmZhbHNlfQ%3D%3D) |
| blowup-4-adam-alibi-bf16 | + bf16 precision | [logs]() | [tb](https://huggingface.co/nouamanetazi/lumi_logs/tensorboard?scroll=1#scalars&runSelectionState=eyJ0ZW5zb3Jib2FyZC9ibG93dXAtMS8xNzkzNDA0IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTIvMTc5MzQzOCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0yLWFkYW0vMTc5MzQ4OCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0vMTc5MzQ5MCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0tZ3B1MS8xNzkzNTAzIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1mcDMyLzE3OTM1MDEiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtMy1hZGFtLXplcm8vMTc5MzUxNCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0vMTc5MzczNiI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0tbm9rZXJuZWwvMTc5Mzc2MyI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmkvMTc5NDIzNSI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmktYmYxNi8xNzk2MjI5Ijp0cnVlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLW5va2VybmVsLzE3OTYyOTciOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLWFsaWJpLWZwMzIvMTc5NjMwMCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmktYmYxNi1ub2tlcm5lbC8xNzk5NzY3IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1mcDMyLW5va2VybmVsLzE3OTk3NzEiOmZhbHNlfQ%3D%3D) |
| blowup-4-adam-alibi-fp32 | + fp32 precision | [logs]() | [tb](https://huggingface.co/nouamanetazi/lumi_logs/tensorboard?scroll=1#scalars&runSelectionState=eyJ0ZW5zb3Jib2FyZC9ibG93dXAtMS8xNzkzNDA0IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTIvMTc5MzQzOCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0yLWFkYW0vMTc5MzQ4OCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0vMTc5MzQ5MCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0tZ3B1MS8xNzkzNTAzIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1mcDMyLzE3OTM1MDEiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtMy1hZGFtLXplcm8vMTc5MzUxNCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0vMTc5MzczNiI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0tbm9rZXJuZWwvMTc5Mzc2MyI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmkvMTc5NDIzNSI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmktYmYxNi8xNzk2MjI5IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1ub2tlcm5lbC8xNzk2Mjk3IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1mcDMyLzE3OTYzMDAiOnRydWUsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmktYmYxNi1ub2tlcm5lbC8xNzk5NzY3IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1mcDMyLW5va2VybmVsLzE3OTk3NzEiOmZhbHNlfQ%3D%3D) |
| blowup-4-adam-alibi-bf16-nokernel | + no custom kernels | [logs]() | [tb](https://huggingface.co/nouamanetazi/lumi_logs/tensorboard?scroll=1#scalars&runSelectionState=eyJ0ZW5zb3Jib2FyZC9ibG93dXAtMS8xNzkzNDA0IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTIvMTc5MzQzOCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0yLWFkYW0vMTc5MzQ4OCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0vMTc5MzQ5MCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0tZ3B1MS8xNzkzNTAzIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1mcDMyLzE3OTM1MDEiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtMy1hZGFtLXplcm8vMTc5MzUxNCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0vMTc5MzczNiI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0tbm9rZXJuZWwvMTc5Mzc2MyI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmkvMTc5NDIzNSI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmktYmYxNi8xNzk2MjI5IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1ub2tlcm5lbC8xNzk2Mjk3IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1mcDMyLzE3OTYzMDAiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLWFsaWJpLWJmMTYtbm9rZXJuZWwvMTc5OTc2NyI6dHJ1ZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1mcDMyLW5va2VybmVsLzE3OTk3NzEiOmZhbHNlfQ%3D%3D) |
| blowup-4-adam-alibi-fp32-nokernel | + no custom kernels | [logs]() | [tb](https://huggingface.co/nouamanetazi/lumi_logs/tensorboard?scroll=1#scalars&runSelectionState=eyJ0ZW5zb3Jib2FyZC9ibG93dXAtMS8xNzkzNDA0IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTIvMTc5MzQzOCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0yLWFkYW0vMTc5MzQ4OCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0vMTc5MzQ5MCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0tZ3B1MS8xNzkzNTAzIjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTMtYWRhbS1mcDMyLzE3OTM1MDEiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtMy1hZGFtLXplcm8vMTc5MzUxNCI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0vMTc5MzczNiI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC0zLWFkYW0tbm9rZXJuZWwvMTc5Mzc2MyI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmkvMTc5NDIzNSI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmktYmYxNi8xNzk2MjI5IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1ub2tlcm5lbC8xNzk2Mjk3IjpmYWxzZSwidGVuc29yYm9hcmQvYmxvd3VwLTQtYWRhbS1hbGliaS1mcDMyLzE3OTYzMDAiOmZhbHNlLCJ0ZW5zb3Jib2FyZC9ibG93dXAtNC1hZGFtLWFsaWJpLWJmMTYtbm9rZXJuZWwvMTc5OTc2NyI6ZmFsc2UsInRlbnNvcmJvYXJkL2Jsb3d1cC00LWFkYW0tYWxpYmktZnAzMi1ub2tlcm5lbC8xNzk5NzcxIjp0cnVlfQ%3D%3D) |

> Note: custom cuda kernels are disabled by setting `--no-masked-softmax-fusion` and `use_meg_ds_fused_layer_norm=False` [here](https://github.com/bigscience-workshop/Megatron-DeepSpeed/blob/09a35f53abac96903fee50787426b7ee5f63fc62/megatron/model/fused_layer_norm.py#L107) (thanks to @thomas for the tip)
